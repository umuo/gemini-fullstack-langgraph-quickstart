<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“å°é¢„è§ˆåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #1d4ed8;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>æ‰“å°é¢„è§ˆåŠŸèƒ½æµ‹è¯•</h1>
        
        <h2>é—®é¢˜1ï¼šAPI URLä¿®å¤æµ‹è¯•</h2>
        <div class="info">
            <strong>ä¿®å¤å†…å®¹ï¼š</strong>
            <ul>
                <li>å¼€å‘ç¯å¢ƒAPI URL: ç¡®è®¤ä½¿ç”¨ localhost:2024 (LangGraphå¼€å‘æœåŠ¡å™¨)</li>
                <li>ç”Ÿäº§ç¯å¢ƒAPI URL: localhost:8123 (ä¿æŒä¸å˜)</li>
            </ul>
        </div>
        
        <button class="test-button" onclick="testApiUrl()">æµ‹è¯•API URLé…ç½®</button>
        <div id="api-result"></div>
        
        <h2>é—®é¢˜2ï¼šæ–‡ä»¶åç”Ÿæˆæµ‹è¯•</h2>
        <div class="info">
            <strong>ä¿®å¤å†…å®¹ï¼š</strong>
            <ul>
                <li>é™åˆ¶æ–‡ä»¶åé•¿åº¦ (æœ€å¤§50å­—ç¬¦)</li>
                <li>ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œä¿ç•™å®‰å…¨å­—ç¬¦</li>
                <li>æ·»åŠ æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§</li>
                <li>å¤„ç†ç©ºè¾“å…¥å’Œæç«¯æƒ…å†µ</li>
            </ul>
        </div>
        
        <input type="text" id="topic-input" placeholder="è¾“å…¥çŸ¥è¯†ç‚¹ä¸»é¢˜è¿›è¡Œæµ‹è¯•" style="width: 400px; padding: 8px; margin: 10px;">
        <button class="test-button" onclick="testFilename()">æµ‹è¯•æ–‡ä»¶åç”Ÿæˆ</button>
        <div id="filename-result"></div>
        
        <h2>æ‰“å°é¢„è§ˆçª—å£æµ‹è¯•</h2>
        <div class="info">
            <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong>
            <ul>
                <li>ç‚¹å‡»æŒ‰é’®ä¼šæ‰“å¼€æ–°çª—å£</li>
                <li>æ–°çª—å£åŒ…å«PDFé¢„è§ˆå’Œæ‰“å°è®¾ç½®</li>
                <li>æ”¯æŒç›´æ¥æ‰“å°å’Œä¸‹è½½åŠŸèƒ½</li>
            </ul>
        </div>
        
        <button class="test-button" onclick="testPrintPreview()">æµ‹è¯•æ‰“å°é¢„è§ˆçª—å£</button>
        <div id="print-result"></div>
        
        <h2>æµ‹è¯•ç”¨ä¾‹</h2>
        <div class="test-cases">
            <h3>é•¿æ–‡æœ¬æµ‹è¯•ï¼š</h3>
            <button class="test-button" onclick="testLongText()">æµ‹è¯•è¶…é•¿çŸ¥è¯†ç‚¹ä¸»é¢˜</button>
            
            <h3>ç‰¹æ®Šå­—ç¬¦æµ‹è¯•ï¼š</h3>
            <button class="test-button" onclick="testSpecialChars()">æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å¤„ç†</button>
            
            <h3>ç©ºè¾“å…¥æµ‹è¯•ï¼š</h3>
            <button class="test-button" onclick="testEmptyInput()">æµ‹è¯•ç©ºè¾“å…¥å¤„ç†</button>
        </div>
        
        <div id="test-cases-result"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ–‡ä»¶åç”Ÿæˆå‡½æ•°
        function createSafeFilename(topic, maxLength = 50) {
            // Remove special characters and keep only alphanumeric, spaces, hyphens, underscores
            let safeChars = topic.replace(/[^\w\s\-_.]/g, '').trim();
            
            // Replace multiple spaces with single space
            safeChars = safeChars.replace(/\s+/g, ' ');
            
            // Replace spaces with underscores
            safeChars = safeChars.replace(/\s/g, '_');
            
            // Limit length and ensure it doesn't end with underscore
            if (safeChars.length > maxLength) {
                safeChars = safeChars.substring(0, maxLength).replace(/_+$/, '');
            }
            
            // If empty or too short, use default
            if (safeChars.length < 3) {
                safeChars = "exam";
            }
            
            return safeChars;
        }

        function testApiUrl() {
            const result = document.getElementById('api-result');
            const isDev = window.location.hostname === 'localhost';
            const expectedUrl = isDev ? 'http://localhost:2024' : 'http://localhost:8123';
            
            result.innerHTML = `
                <div class="success">
                    âœ… API URLé…ç½®æ­£ç¡®<br>
                    å½“å‰ç¯å¢ƒ: ${isDev ? 'å¼€å‘ç¯å¢ƒ' : 'ç”Ÿäº§ç¯å¢ƒ'}<br>
                    APIåœ°å€: ${expectedUrl}
                </div>
            `;
        }

        function testFilename() {
            const input = document.getElementById('topic-input').value;
            const result = document.getElementById('filename-result');
            
            if (!input.trim()) {
                result.innerHTML = '<div class="error">âŒ è¯·è¾“å…¥çŸ¥è¯†ç‚¹ä¸»é¢˜</div>';
                return;
            }
            
            const safeFilename = createSafeFilename(input);
            const timestamp = new Date().toISOString().replace(/[-:]/g, '').replace(/\..+/, '').replace('T', '_');
            
            const examFile = `${safeFilename}_medium_${timestamp}_exam.pdf`;
            const answerFile = `${safeFilename}_medium_${timestamp}_answer_key.pdf`;
            const notesFile = `${safeFilename}_medium_${timestamp}_notes.pdf`;
            
            result.innerHTML = `
                <div class="success">
                    âœ… æ–‡ä»¶åç”ŸæˆæˆåŠŸ<br>
                    <strong>åŸå§‹è¾“å…¥:</strong> ${input}<br>
                    <strong>å®‰å…¨æ–‡ä»¶å:</strong> ${safeFilename}<br>
                    <strong>è¯•å·æ–‡ä»¶:</strong> ${examFile}<br>
                    <strong>ç­”æ¡ˆæ–‡ä»¶:</strong> ${answerFile}<br>
                    <strong>ç¬”è®°æ–‡ä»¶:</strong> ${notesFile}
                </div>
            `;
        }

        function testPrintPreview() {
            const result = document.getElementById('print-result');
            
            // æ¨¡æ‹Ÿæ‰“å°é¢„è§ˆçª—å£
            const printWindow = window.open('', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
            
            if (printWindow) {
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>æ‰“å°é¢„è§ˆæµ‹è¯•</title>
                        <style>
                            body { margin: 0; padding: 20px; font-family: Arial, sans-serif; background: #f5f5f5; }
                            .header { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                            .pdf-container { background: white; padding: 20px; border-radius: 8px; text-align: center; }
                            .test-content { border: 2px dashed #ccc; padding: 40px; margin: 20px 0; }
                            button { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h2>æ‰“å°é¢„è§ˆæµ‹è¯•çª—å£</h2>
                            <button onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
                            <button onclick="window.close()">âŒ å…³é—­</button>
                        </div>
                        <div class="pdf-container">
                            <div class="test-content">
                                <h3>ğŸ“„ è¿™é‡Œæ˜¯PDFå†…å®¹é¢„è§ˆåŒºåŸŸ</h3>
                                <p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºç”Ÿæˆçš„è¯•å·PDF</p>
                                <p>ç”¨æˆ·å¯ä»¥åœ¨æ­¤é¢„è§ˆè¯•å·å†…å®¹å¹¶è¿›è¡Œæ‰“å°</p>
                            </div>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                
                result.innerHTML = '<div class="success">âœ… æ‰“å°é¢„è§ˆçª—å£å·²æ‰“å¼€ï¼Œè¯·æŸ¥çœ‹æ–°çª—å£</div>';
            } else {
                result.innerHTML = '<div class="error">âŒ æ— æ³•æ‰“å¼€æ‰“å°é¢„è§ˆçª—å£ï¼Œå¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢</div>';
            }
        }

        function testLongText() {
            const longText = "è¿™æ˜¯ä¸€ä¸ªéå¸¸éå¸¸é•¿çš„çŸ¥è¯†ç‚¹ä¸»é¢˜ï¼ŒåŒ…å«äº†å¾ˆå¤šè¯¦ç»†çš„å†…å®¹å’Œæè¿°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶åè¿‡é•¿çš„é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œé€‚å½“çš„æˆªæ–­å’Œå¤„ç†ï¼Œç¡®ä¿æ–‡ä»¶ååœ¨å„ç§æ“ä½œç³»ç»Ÿä¸‹éƒ½èƒ½æ­£å¸¸ä½¿ç”¨";
            document.getElementById('topic-input').value = longText;
            testFilename();
        }

        function testSpecialChars() {
            const specialText = "å‡½æ•°y=axÂ²+bx+cçš„æ€§è´¨ç ”ç©¶ï¼@#$%^&*()ï¼ŒåŒ…å«å„ç§ç‰¹æ®Šå­—ç¬¦ï¼š<>:\"/\\|?*";
            document.getElementById('topic-input').value = specialText;
            testFilename();
        }

        function testEmptyInput() {
            document.getElementById('topic-input').value = "";
            testFilename();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•API URL
        window.onload = function() {
            testApiUrl();
        };
    </script>
</body>
</html>